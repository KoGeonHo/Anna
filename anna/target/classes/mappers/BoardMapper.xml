<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="board.newBoard.mapper.boardMapper">

	<select id="list" parameterType="boardVO" resultType="boardVO">
	
		SELECT
			a.bidx,
			b.userName,
			b.userId,
			a.boardType,
			a.title,
			a.contents,
			a.attach,
			a.hit,
			DATE_FORMAT(a.wDate,'%Y-%m-%d') as wDate
		FROM NewBoard_Board a Join NewBoard_User b ON a.midx = b.midx
		WHERE 
			a.isDel = 'N' AND
			a.boardType = #{ boardType } 
			
			<if test='searchType != null and searchType.equals("all")'>
				AND (
					a.title like CONCAT('%',#{searchVal},'%') OR
					a.contents like CONCAT('%',#{searchVal},'%') OR
					b.userName like CONCAT('%',#{searchVal},'%')
				)
			</if>
			<if test='searchType != null and searchType.equals("titleContent")'>
				AND (
					a.title like CONCAT('%',#{searchVal},'%') OR
					a.contents like CONCAT('%',#{searchVal},'%')
				)
			</if>
			<if test='searchType != null and searchType.equals("writer")'>
				AND b.userName like CONCAT('%',#{searchVal},'%')
			</if>
			
		ORDER BY a.bidx DESC
		LIMIT ${ (pageNum-1)*listIdx } , #{ listIdx }
	
	</select>
	
	<select id="cntList" parameterType="boardVO" resultType="_int">
		SELECT
			count(*) as cnt
		FROM NewBoard_Board a Join NewBoard_User b ON a.midx = b.midx
		WHERE 
			a.isDel = 'N' AND
			a.boardType = #{ boardType }
			<if test='searchType != null and searchType.equals("all")'>
				AND (
					a.title like CONCAT('%',#{searchVal},'%') OR
					a.contents like CONCAT('%',#{searchVal},'%') OR
					b.userName like CONCAT('%',#{searchVal},'%')
				)
			</if>
			<if test='searchType != null and searchType.equals("titleContent")'>
				AND (
					a.title like CONCAT('%',#{searchVal},'%') OR
					a.contents like CONCAT('%',#{searchVal},'%')
				)
			</if>
			<if test='searchType != null and searchType.equals("writer")'>
				AND b.userName like CONCAT('%',#{searchVal},'%')
			</if>
	</select>
	
	<insert id="write" parameterType="boardVO">
		
		INSERT INTO NewBoard_Board(
			boardType,
			midx,
			title,
			contents,
			attach
		) VALUES (
			#{ boardType },
			#{ midx },
			#{ title },
			#{ contents },
			#{ attach }
		)
		
	</insert>
	
	<select id="view" parameterType="int" resultType="boardVO">
	
		SELECT
			a.bidx,
			a.midx,
			b.userName,
			b.userId,
			a.title,
			a.contents,
			a.attach,
			a.hit,
			DATE_FORMAT(a.wDate,'%Y-%m-%d') as wDate
		FROM NewBoard_Board a Join NewBoard_User b ON a.midx = b.midx
		WHERE 
			a.bidx = #{ bidx }			
	
	</select>
	
	<update id="viewCnt" parameterType="int">
		
		UPDATE NewBoard_Board SET
			hit = hit + 1
		WHERE bidx = #{ bidx }
		
	</update>
	
	<update id="modify" parameterType="boardVO">
	
		UPDATE NewBoard_Board SET
			title = #{ title },
			contents = #{ contents }
			<if test="attach != null">
				, attach = #{ attach }
			</if>
		WHERE bidx = #{ bidx }
		
	</update>
	
	<update id="del" parameterType="int">
		
		UPDATE NewBoard_Board SET
			isDel = 'Y'
		WHERE bidx = #{ bidx }
		
	</update>
	
</mapper>